<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routine Now?</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="container">
        <!-- Header Section -->
        <header>
            <div class="logo-container">
                <img src="1.png" alt="Routine Now Logo" class="logo">
                <h1>Routine Now?(60_F)</h1>
            </div>
        </header>

        <!-- Day Selection -->
        <div class="day-selection">
            <div class="day-card" data-day="saturday">Saturday</div>
            <div class="day-card" data-day="sunday">Sunday</div>
            <div class="day-card" data-day="monday">Monday</div>
            <div class="day-card" data-day="tuesday">Tuesday</div>
            <div class="day-card" data-day="wednesday">Wednesday</div>
            <div class="day-card" data-day="thursday">Thursday</div>
            
        </div>

        <!-- Routine Display Section -->
        <div id="routineDisplay" class="routine-display">
            <h2 id="selectedDay">Select a day to view the routine</h2>
            <div id="routineList"></div>
        </div>

        <!-- PDF Download Button -->
        <div class="pdf-download">
            <button id="downloadPdfBtn">
                <i class="fas fa-file-pdf"></i> PDF Routine
            </button>
            <p>Download</p>
        </div>

        <!-- Footer Section -->
        <footer>
            <p>&copy; 2025 ISOLATE. All rights reserved.</p>
        </footer>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA0Q3-U2HcoGpDnUgY0t_NsyNSvpyrWzx0",
            authDomain: "routine-now.firebaseapp.com",
            projectId: "routine-now",
            storageBucket: "routine-now.appspot.com",
            messagingSenderId: "830396870615",
            appId: "1:830396870615:web:03c3a023de9e0f0ee52592"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const dayCards = document.querySelectorAll(".day-card");
        const routineList = document.getElementById("routineList");
        const selectedDayHeader = document.getElementById("selectedDay");

        let allRoutineData = {}; // Object to store routine data for all days

        // Fetch routine data for all days but don't display until the PDF download
        const daysOfWeek = ["saturday","sunday","monday", "tuesday", "wednesday", "thursday"];
        daysOfWeek.forEach((day) => {
            const routineRef = ref(db, `routine/${day}`);
            onValue(routineRef, (snapshot) => {
                if (snapshot.exists()) {
                    allRoutineData[day] = snapshot.val(); // Store the fetched routine data for this day
                }
            });
        });

        // Fetch and display routine for the selected day
        dayCards.forEach((card) => {
            card.addEventListener("click", () => {
                const selectedDay = card.dataset.day;
                selectedDayHeader.textContent = selectedDay.charAt(0).toUpperCase() + selectedDay.slice(1);

                // Get routine data from Firebase for the selected day
                const routineData = allRoutineData[selectedDay] || [];
                routineList.innerHTML = ""; // Clear previous routine

                if (routineData.length > 0) {
                    routineData.forEach((entry) => {
                        const routineBlock = document.createElement("div");
                        routineBlock.className = "routine-block";
                        routineBlock.innerHTML = `<p><strong>${entry.subject}</strong>: ${entry.time}</p>`;
                        routineList.appendChild(routineBlock);
                    });
                } else {
                    routineList.innerHTML = "<p>No routine available for this day.</p>";
                }
            });
        });

        // PDF Download Functionality
        document.getElementById('downloadPdfBtn').addEventListener('click', function () {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Add "Section: 60_F" at the top-center of the PDF
            doc.setFontSize(14);
            doc.setFont("helvetica", "normal");
            doc.text("Section: 60_F", doc.internal.pageSize.width / 2, 20, { align: 'center' });

            // Title of the PDF
            doc.setFontSize(20);
            doc.setFont("helvetica", "bold");
            doc.text("Weekly Routine", 20, 30);

            // Set basic font and size for the table
            doc.setFont("helvetica", "normal");
            doc.setFontSize(12);

            let yOffset = 40; // Adjust for header space

            // Adding borders and sections for each day
            daysOfWeek.forEach((day) => {
                const dayRoutine = allRoutineData[day]; // Use the data stored earlier

                if (dayRoutine && dayRoutine.length > 0) {
                    // Draw a simple border around each day's section
                    doc.setLineWidth(0.5);
                    doc.rect(20, yOffset - 5, 180, 10); // Outer border for the day header

                    // Set header for each day
                    doc.setTextColor(255, 255, 255); // White text for day header
                    doc.setFillColor(0, 0, 128); // Dark Blue background for day name
                    doc.rect(20, yOffset - 5, 180, 10, 'F'); // Fill the header with color
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(14); // Increase font size for day header
                    doc.text(day.charAt(0).toUpperCase() + day.slice(1), 25, yOffset + 2); // Adjusted to move day name upwards

                    yOffset += 10; // Space for day header

                    // Add table header for Subject and Time
                    doc.setTextColor(0, 0, 0); // Black text for table content
                    doc.text("Subject", 20, yOffset);
                    doc.text("Time", 120, yOffset);

                    // Add a small line separator
                    doc.setLineWidth(0.5);
                    doc.line(20, yOffset + 2, 200, yOffset + 2); // Horizontal line

                    yOffset += 8; // Space after table header

                    // Add table rows for each routine entry
                    dayRoutine.forEach((entry) => {
                        doc.text(entry.subject, 20, yOffset);
                        doc.text(entry.time, 120, yOffset);

                        // Add line separators after each row
                        doc.line(20, yOffset + 2, 200, yOffset + 2); // Row separator
                        yOffset += 8; // Space for next row
                    });

                    yOffset += 12; // Space after each day's routine
                }
            });

            // Save the generated PDF
            doc.save("weekly_routine.pdf");
        });
    </script>
</body>

</html>
